# CHANGE-COMPLEXITY-MATRIX.md

이 문서는 WWAI-03-SOP 프로젝트의 변경 요청을 복잡도별로 분류하는 기준을 제공합니다.

---

## 🟢 LOW - 비개발자 단독 수정 가능 (AI 가이드 활용)

### 설정값 변경
**예시**:
- ✅ 타임아웃 값 변경: `timeout=60` → `timeout=90`
- ✅ 재시도 횟수 변경: `for attempt in range(1, 4)` → `range(1, 5)`
- ✅ 대기 시간 변경: `await page.wait_for_timeout(2000)` → `3000`
- ✅ 로그인 대기 시간 변경

**위치**:
- `01.smartThings/smartThings_main.py`: 타임아웃, 재시도 횟수
- `02.ENH/*/main.py`: DEFAULT_TARGETS 배열

**AI 프롬프트 예시**:
```
@CLAUDE.md
@01.smartThings/smartThings_main.py

타임아웃을 60초에서 90초로 늘려줘.
어떤 라인을 수정해야 하는지 단계별로 알려줘.
```

---

### URL 및 경로 변경
**예시**:
- ✅ 테스트 URL 변경
- ✅ 결과 파일 저장 경로 변경
- ✅ Excel 파일 경로 변경 (01.smartThings)

**주의사항**:
- Windows vs macOS 경로 차이 (`\` vs `/`)
- 절대 경로 vs 상대 경로

**위치**:
- `01.smartThings/smartThings_main.py`: line 52-63 (파일 경로)
- `02.ENH/*/main.py`: DEFAULT_TARGETS

**AI 프롬프트 예시**:
```
@01.smartThings/smartThings_main.py

Windows 경로를 macOS 경로로 바꿔줘:
C:\Users\WW\Desktop\삼성 프로젝트 관련 파일
→ /Users/bombbie/Desktop/samsung-project

주의할 점도 알려줘.
```

---

### CSS 선택자 변경 (단순 교체)
**예시**:
- ✅ 버튼 클래스 변경: `.old-button` → `.new-button`
- ✅ 입력 필드 선택자 변경: `input[name='old']` → `input[name='new']`

**필수 검증**:
1. 브라우저 개발자 도구로 새 선택자 확인
2. 선택자가 단일 요소를 가리키는지 확인
3. 페이지 로딩 후에도 존재하는지 확인

**위치**:
- `02.ENH/pd/pd_modules/selectors.py`: 모든 선택자 상수
- `02.ENH/pf/pf_modules/selectors.py`: 모든 선택자 상수

**AI 프롬프트 예시**:
```
@02.ENH/pd/pd_modules/selectors.py

웹사이트가 리뉴얼되어 "Add to Cart" 버튼의 클래스가 바뀌었어.
새 클래스: .cta-add-to-cart-new

기존 선택자를 찾아서 교체하는 방법을 단계별로 알려줘.
브라우저에서 확인하는 방법도 알려줘.
```

---

### 로그 메시지 추가/변경
**예시**:
- ✅ `print()` 문 추가
- ✅ 기존 로그 메시지 수정
- ✅ 디버깅용 변수 출력

**위치**: 모든 .py 파일

**AI 프롬프트 예시**:
```
@02.ENH/pd/main.py

각 검증 단계가 시작될 때마다 로그를 출력하고 싶어.
"[검증명] 시작..." 형식으로.

어디에 어떻게 추가하면 되는지 알려줘.
```

---

### 데이터 파일 수정
**예시**:
- ✅ CSV 파일의 계정 정보 변경
- ✅ Excel 테스트 데이터 수정
- ✅ 프롬프트 텍스트 수정 (.md 파일)

**매우 안전**:
- `02.ENH/smartthings-logic/data/account.csv`
- `02.ENH/smartthings-logic/data/story.csv`
- `02.ENH/smartthings-logic/prompt/*.md`

**주의 필요**:
- `01.smartThings/` 관련 Excel 파일 (컬럼 순서 유지 필수)

**AI 프롬프트 예시**:
```
@02.ENH/smartthings-logic/prompt/story_prompt.md

이 프롬프트에서 "완벽 매칭" 조건을 더 명확하게 설명하고 싶어.
현재 프롬프트를 읽고, 어떻게 개선하면 좋을지 제안해줘.
```

---

### 국가/사이트 코드 추가
**예시**:
- ✅ 새 국가 코드 추가: `country_codes = ['DE', 'FR', 'ES', 'IT', 'UK']`
- ✅ 사이트 코드 리스트 확장

**위치**:
- `01.smartThings/smartThings_main.py`: line 85 (country_codes)

**AI 프롬프트 예시**:
```
@01.smartThings/smartThings_main.py

UK 국가 코드를 추가하고 싶어.
어떤 부분을 수정해야 하는지,
다른 영향받는 부분은 없는지 확인해줘.
```

---

## 🟡 MEDIUM - AI 도움 + 개발자 리뷰 필요

### 새로운 검증 항목 추가 (기존 패턴 복사)
**예시**:
- ⚠️ PF에 새로운 요소 가시성 검증 추가
- ⚠️ PD에 새로운 버튼 클릭 검증 추가

**패턴**:
1. 기존 검증 함수 복사
2. 선택자 변경
3. 검증 로직 수정
4. main.py에 호출 추가
5. 결과 JSON에 필드 추가

**위치**:
- `02.ENH/pf/pf_modules/` (새 검증 모듈 또는 기존 모듈 확장)
- `02.ENH/pd/pd.py` (검증 함수들)

**AI 프롬프트 예시**:
```
@CLAUDE.md
@02.ENH/pf/pf_modules/headline.py
@02.ENH/pf/main.py

헤드라인 검증과 비슷하게,
서브헤드라인(.co77-subheadline)도 검증하고 싶어.

1. headline.py 패턴을 복사해서 만들어줘
2. main.py에서 호출하는 방법 알려줘
3. 테스트 방법 알려줘

단계별로 천천히 진행하자.
```

**필수 리뷰 사항**:
- 에러 처리 누락 여부
- 기존 검증과의 충돌 가능성
- 성능 영향 (너무 느려지지 않는지)

---

### 조건문 수정/추가
**예시**:
- ⚠️ `if` 조건 변경
- ⚠️ `try-except` 블록 추가
- ⚠️ 에러 처리 로직 추가

**안전한 예시**:
```python
# 단순 비교값 변경
if count > 10:  → if count > 20:

# 문자열 비교 추가
if status == "success":  → if status in ["success", "ok"]:
```

**위험한 예시** (개발자 필수):
```python
# 복잡한 조건 추가
if (condition1 and condition2) or (condition3 and not condition4):
```

**AI 프롬프트 예시**:
```
@02.ENH/pd/pd.py

현재 평점이 있을 때만 검증을 통과하는데,
평점이 없어도 OK로 처리하고 싶어.

현재 로직을 보여주고,
어떻게 수정하면 되는지 단계별로 알려줘.
위험 요소도 알려줘.
```

**필수 리뷰 사항**:
- 모든 분기(branch)에 대한 테스트
- Edge case 처리 확인
- 기존 동작에 영향 없는지 확인

---

### 에러 메시지 처리 개선
**예시**:
- ⚠️ 새로운 예외 타입 처리
- ⚠️ 에러 메시지 세분화
- ⚠️ Fallback 로직 추가

**AI 프롬프트 예시**:
```
@02.ENH/shop/shop.py

링크 검증 실패 시 현재는 그냥 False만 반환하는데,
실패 이유(404, timeout, error page 등)를
상세하게 기록하고 싶어.

현재 코드를 분석하고,
개선 방법을 제안해줘.
```

**필수 리뷰 사항**:
- 모든 예외 타입 처리했는지
- 에러 전파가 올바른지
- 로그가 충분한지

---

### 여러 파일 동시 수정 (일관된 패턴)
**예시**:
- ⚠️ 모든 프로젝트에 공통 유틸리티 함수 추가
- ⚠️ 선택자 파일 분리 후 import 수정

**AI 프롬프트 예시**:
```
@02.ENH/pd/pd.py
@02.ENH/pf/pf.py

두 파일 모두에서 사용하는 링크 검증 로직을
공통 유틸리티로 분리하고 싶어.

1. utility/link_validator.py 파일 생성
2. 공통 로직 추출
3. 두 파일에서 import하여 사용

단계별로 진행하자. 각 단계마다 테스트할게.
```

**필수 리뷰 사항**:
- Import 순환 참조 없는지
- 모든 파일에서 정상 작동하는지
- 기존 기능 영향 없는지

---

## 🔴 HIGH - 개발자 필수

### 비동기 (async/await) 로직 수정
**예시**:
- ❌ API 호출 순서 변경
- ❌ `await` 추가/제거
- ❌ 병렬 처리 로직 수정

**이유**:
- 데드락(deadlock) 발생 가능
- 레이스 컨디션(race condition) 위험
- 데이터 일관성 문제

**절대 시도 금지**:
```python
# 이런 코드 수정 시도 금지
async def function():
    await something()  # 순서 변경 금지
    await another()    # 병렬화 시도 금지
```

**개발자 요청 시 포함 정보**:
- 왜 순서를 바꾸고 싶은지
- 어떤 문제를 해결하려는지
- 예상하는 동작

---

### API 엔드포인트 변경
**예시**:
- ❌ 새로운 API URL 추가
- ❌ API 응답 구조 변경 처리
- ❌ 인증 로직 수정

**영향 범위**:
- `01.smartThings/smartThings_module/response_handler.py`
- 모든 API 관련 코드

**이유**:
- API 계약(contract) 이해 필요
- 에러 처리 복잡
- 데이터 구조 변경 영향

---

### 복잡한 알고리즘 수정
**예시**:
- ❌ 5단계 추천 로직 변경 (smartthings-logic)
- ❌ 제품 우선순위 계산 로직 변경
- ❌ 정렬 알고리즘 수정

**영향 범위**:
- `01.smartThings/smartThings_module/product_result.py`
- `02.ENH/smartthings-logic/processor.py`

**이유**:
- 비즈니스 로직 이해 필요
- 엣지 케이스 처리 복잡
- 테스트 케이스 다양

---

### Class 구조 변경
**예시**:
- ❌ 새로운 Class 추가
- ❌ 상속 구조 변경
- ❌ 메서드 시그니처 변경

**이유**:
- 객체지향 설계 이해 필요
- 전체 아키텍처 영향
- 리팩토링 필요

---

### 의존성 업그레이드
**예시**:
- ❌ Playwright 버전 업그레이드
- ❌ Pandas 버전 변경
- ❌ Python 버전 변경

**이유**:
- API 변경 가능성
- 호환성 문제
- 의존성 충돌

**절대 금지**:
```bash
# 이런 명령 실행 금지
pip install --upgrade playwright
pip install --upgrade pandas
```

---

### 보안 관련
**예시**:
- ❌ 로그인 로직 수정
- ❌ 인증 토큰 처리
- ❌ 비밀번호 저장 방식 변경

**이유**:
- 보안 취약점 발생 가능
- 규정 준수 필요
- 전문 지식 필요

---

## 의사결정 플로우차트

```
변경 요청
    ↓
┌──────────────────────┐
│ 설정값/데이터/로그?  │ → YES → 🟢 LOW (직접 수정)
└──────────────────────┘
    ↓ NO
┌──────────────────────┐
│ async/await 포함?    │ → YES → 🔴 HIGH (개발자 필수)
└──────────────────────┘
    ↓ NO
┌──────────────────────┐
│ API/Class 변경?      │ → YES → 🔴 HIGH (개발자 필수)
└──────────────────────┘
    ↓ NO
┌──────────────────────┐
│ 알고리즘 변경?       │ → YES → 🔴 HIGH (개발자 필수)
└──────────────────────┘
    ↓ NO
┌──────────────────────┐
│ 의존성 변경?         │ → YES → 🔴 HIGH (개발자 필수)
└──────────────────────┘
    ↓ NO
┌──────────────────────┐
│ 기존 패턴 복사?      │ → YES → 🟡 MEDIUM (AI + 리뷰)
└──────────────────────┘
    ↓ NO
┌──────────────────────┐
│ 조건문/에러 처리?    │ → YES → 🟡 MEDIUM (AI + 리뷰)
└──────────────────────┘
    ↓ NO
확실하지 않으면 → 🔴 HIGH (개발자 상담)
```

---

## 복잡도 판단 시 질문 체크리스트

### 스스로에게 물어보기:

1. **이 변경이 async/await와 관련 있나요?**
   - YES → 🔴 HIGH

2. **이 변경이 외부 API나 데이터베이스와 관련 있나요?**
   - YES → 🔴 HIGH

3. **이 변경이 2개 이상의 파일을 수정하나요?**
   - YES → 최소 🟡 MEDIUM

4. **이 변경을 되돌리기 어려운가요?**
   - YES → 복잡도 +1단계

5. **이 변경의 영향 범위를 100% 이해하고 있나요?**
   - NO → 복잡도 +1단계

6. **비슷한 변경을 성공적으로 해본 적이 있나요?**
   - NO → 복잡도 +1단계

7. **이 변경을 테스트할 방법이 명확한가요?**
   - NO → 🟡 MEDIUM 이상

8. **AI가 "개발자 리뷰 권장"이라고 했나요?**
   - YES → 최소 🟡 MEDIUM

---

## 프로젝트별 특수 고려사항

### 01.smartThings
- **쉬움**: 타임아웃, 재시도, 국가 코드, 파일 경로
- **중간**: 새로운 API 엔드포인트 모니터링, HTML 선택자 추가
- **어려움**: API 응답 처리 로직, Excel 데이터 매핑 로직

### 02.ENH/gnb
- **쉬움**: CGD 파일 경로, 비교 로직의 허용 오차
- **중간**: 새로운 메뉴 레벨 추가 (L3)
- **어려움**: 트리 비교 알고리즘

### 02.ENH/pd
- **쉬움**: 선택자 변경, 타임아웃, WDS 로그인 설정
- **중간**: 새로운 검증 항목 추가 (패턴 복사)
- **어려움**: Dimension 계산 로직, 가격 비교 알고리즘

### 02.ENH/pf
- **쉬움**: 선택자 변경, 필터 조합 개수 조정
- **중간**: 새로운 검증 항목 추가, DOM 비교 로직 수정
- **어려움**: 필터 조합 생성 알고리즘, 비동기 병렬 검증

### 02.ENH/shop
- **쉬움**: 타임아웃, 재시도 횟수
- **중간**: 새로운 메뉴 레벨 추가
- **어려움**: 메뉴 탐색 로직

### 02.ENH/smartthings-logic
- **쉬움**: 프롬프트 텍스트 수정 (.md 파일), API 키 변경
- **중간**: 새로운 특례 조건 추가
- **어려움**: 5단계 정렬 로직, LLM 응답 파싱 로직

---

## 정리

- **🟢 LOW**: 숫자, 문자열, 경로 변경. 바로 시도 OK
- **🟡 MEDIUM**: 패턴 복사, 조건 추가. AI + 리뷰 필수
- **🔴 HIGH**: async, API, 알고리즘. 개발자 필수

**의심스러우면 한 단계 위로!**
안전이 최우선입니다.
